<!DOCTYPE html>

<html lang="sv">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Delar</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="icon" type="image/png" sizes="32x32" href="Infinity_Camper_Logo.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
</head>

<body>
    <!-- Topbar -->
    <header class="topbar">
        <img src="infi.camp.png" alt="Camp logo" class="topbar-img">

        <!-- Hamburger toggle -->
        <div class="menu-toggle" id="mobile-menu">
            <i class="fa fa-bars"></i>
        </div>

        <!-- Navigationsmeny -->
        <nav class="nav" id="navbar">
            <a href="index.html">Home</a>
            <a href="produkter.html">Infinity Camper</a>
            <a href="delar.html">Älgstaket/Frontbågar till Lastbilar</a>
        </nav>

        <img src="CGT_bild-removebg-preview.png" alt="cgt bild" class="topbar-img">
    </header>

    <main>
        <div class="main-container">
            <div class="filter-bar">
                <h1>Älgstaket</h1>
                <select id="filter-select">
                <option value="all">Alla</option>
              </select>
            </div>

            <div id="delar-gallery" class="gallery"></div>
        </div>



    </main>

    <footer class="footer">
        <h2>Kontakt</h2>
        <p><strong>Telefon:</strong> +46735913525</p>
        <p><strong>E-mail:</strong> <a href="mailto:Info@cgtsweden.se">Info@cgtsweden.se</a></p>
        <div class="socials">
            <a href="https://www.facebook.com/share/1B5CBZM7mx/" target="_blank"><i class="fa-brands fa-square-facebook"></i></a>
        </div>
    </footer>

    <!-- Modal -->
    <div id="modal" class="modal">
        <span class="close-btn">&times;</span>
        <div class="modal-content">
            <img id="modal-img" src="" alt="">
            <div class="modal-info">
                <h2 id="modal-title"></h2>
                <p><strong>Pris:</strong> <span id="modal-price"></span></p>
                <p id="modal-desc"></p>
            </div>
        </div>
    </div>

    <script>
        // === Hamburgermeny logik ===
        const mobileMenu = document.getElementById('mobile-menu');
        const navbar = document.getElementById('navbar');

        mobileMenu.addEventListener('click', () => {
            navbar.classList.toggle('active');
        });
        const wpApiUrl = "https://www.cgtsweden.se/wp-json/wp/v2/media?per_page=100&_embed";
        const delarCategoryId = 4; // Kategori-ID för "Älgstaket"
        let allItems = [];



        fetch(wpApiUrl)
            .then(res => res.json())
            .then(data => {
                // Filtrera fram rätt kategori (Älgstaket)
                const filtered = data.filter(img =>
                    img.attachment_categories && img.attachment_categories.includes(delarCategoryId)
                );
                allItems = filtered;


                const tags = new Map();
                filtered.forEach(img => {
                    if (img._embedded && img._embedded["wp:term"]) {
                        const tagTerms = img._embedded["wp:term"].find(t => t.length && t[0].taxonomy === "attachment_tag");
                        if (tagTerms) {
                            tagTerms.forEach(tagObj => {
                                tags.set(tagObj.id, tagObj.name);
                            });
                        }
                    }
                });


                const select = document.getElementById("filter-select");
                tags.forEach((name, id) => {
                    const opt = document.createElement("option");
                    opt.value = id;
                    opt.textContent = name
                    select.appendChild(opt);
                });

                // Rendera galleriet första gången
                renderGallery(filtered);

                // Lyssna på filterändringar
                select.addEventListener("change", () => {
                    const value = select.value;
                    if (value === "all") {
                        renderGallery(allItems);
                    } else {
                        const filteredByTag = allItems.filter(img =>
                            img.attachment_tags && img.attachment_tags.includes(parseInt(value))
                        );
                        renderGallery(filteredByTag);
                    }
                });
            })
            .catch(err => console.error("Fel vid hämtning av bilder:", err));

        // Funktion för att rendera galleri
        function renderGallery(items) {
            const gallery = document.getElementById("delar-gallery");
            gallery.innerHTML = items.map(img => `
            <div class="gallery-item" 
                data-title="${img.title.rendered}" 
                data-price="${img.caption.rendered.replace(/(<([^>]+)>)/gi, '') || 'Kontakta oss'}" 
                data-desc="${(img.description.rendered).replace(/(<([^>]+)>)/gi, '')}" 
                data-src="${img.source_url}"
                data-tags="${img.attachment_tags ? img.attachment_tags.join(',') : ''}">
                <img src="${img.source_url}" alt="${img.alt_text || 'Delar-bild'}">
                <h3>${img.title.rendered}</h3>
            </div>
        `).join("");

            // Modal logik
            const modal = document.getElementById("modal");
            const modalImg = document.getElementById("modal-img");
            const modalTitle = document.getElementById("modal-title");
            const modalPrice = document.getElementById("modal-price");
            const modalDesc = document.getElementById("modal-desc");
            const closeBtn = document.querySelector(".close-btn");

            document.querySelectorAll(".gallery-item").forEach(item => {
                item.addEventListener("click", () => {
                    modal.style.display = "flex";
                    modalImg.src = item.dataset.src;
                    modalTitle.textContent = item.dataset.title;
                    modalPrice.textContent = item.dataset.price;
                    modalDesc.textContent = item.dataset.desc;
                });
            });

            closeBtn.addEventListener("click", () => modal.style.display = "none");
            modal.addEventListener("click", (e) => {
                if (e.target === modal) modal.style.display = "none";
            });
        }
    </script>


</body>

</html>